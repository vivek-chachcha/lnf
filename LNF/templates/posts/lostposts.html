{% extends 'basesite.html' %}

{% load staticfiles %}

{% block title %}Lost Posts{% endblock %}

{% block header %}
Lost Posts
{% endblock %}

{% block content %}


<link rel="stylesheet" type="text/css" href="{%static 'posts/poststyle.css' %}" />
<!DOCTYPE html>
<html>
	<head>
		<title>Lost Posts</title>
		<script src="https://maps.googleapis.com/maps/api/js"></script>
		<script>
			var map;
			var markers = [];
			var mapCenter = new google.maps.LatLng(49.2464056, -123.10000);
			var mapOptions = {
				center : mapCenter,
				zoom : 11,
				mapTypeId : google.maps.MapTypeId.ROADMAP
			}
			function initialize() {
				var mapCanvas = document.getElementById('map');

				map = new google.maps.Map(mapCanvas, mapOptions)

				"{% for post in lost_post_list %}"
					var infowindow = new google.maps.InfoWindow({
						content : "<b>Name: </b>" + "{{ post.name }}" + "<br><b>Date: </b>" + "{{ post.date }}" + "<br><b>Color: </b>" + "{{ post.colour }}" + "<br><b>Breed: </b>" + "{{ post.breed }}" + "<br><b>Sex: </b>" + "{{ post.get_sex_display }}" + "<br><br><a href='/{{post.id}}/post'>View Post</a>",
					});

					markers["{{post.id}}"] = new google.maps.Marker({
						position : new google.maps.LatLng("{{post.lat}}", "{{post.lon}}"),
						map : map,
						infowindow : infowindow,
					});
					
					markers["{{post.id}}"].addListener('click', function () {
						this.infowindow.open(map, this);
						map.setZoom(14);
						map.setCenter(this.getPosition());
					});
				"{% endfor %}"
			}
			google.maps.event.addDomListener(window, 'load', initialize);

			function focusOnMap(id) {
				var focusedmarker = markers[id];
				focusedmarker.infowindow.open(map, focusedmarker);
				map.setZoom(14);
				map.setCenter(focusedmarker.getPosition());
			};

			function swapview(view) {
				if (view === "listview") {
					document.getElementById('posttablelist').style.display = 'block';
					document.getElementById('posttablemap').style.display = 'none';
				} else {
					document.getElementById('posttablemap').style.display = 'block';
					document.getElementById('posttablelist').style.display = 'none';
					google.maps.event.trigger(map, 'resize');
					map.setCenter(mapCenter);
					map.setZoom(11);
				}
			}
    </script>
</head>
<body>
	<div id="changeview"><span id="listview" onclick="swapview('listview')">LIST VIEW</span> | <span id="mapview" onclick="swapview('mapview')">MAP VIEW</span></div>
	<div id="posttablelist" style="display:block">
		<div id="list">
			{% for post in lost_post_list %}
			<div class="row">				
				<div class="entry"><img src="{{ post.image_url }}" height="50" width="50"></div>
				<div class="entry"><b>Name:</b> {{ post.name }}</div>
				<div class="entry"><b>Date:</b> {{ post.get_state_display }}</div>
				<div class="entry"><b>Color:</b> {{ post.colour }}</div>
				<div class="entry"><b>Breed:</b> {{ post.breed }}</div>
				<div class="entry"><b>Sex:</b>  {{ post.get_sex_display }}</div><br>
				<div class="entry"><a href="/{{ post.id }}/post">More Details</a></div>
			</div><br>
			{% endfor %}
		</div>
	</div>
	<div id="posttablemap" style="display:none">
		<div id="map"></div>
		<div id="listtable">
			<center><h3>All Animals With Locations</h3></center>
			<p>
			{% for post in lost_post_list %}
				{% ifnotequal post.lat None %}
					<div class="row" onclick="focusOnMap({{post.id}})">
						<div class="entry"><b>Name:</b> {{ post.name }}</div>
						<div class="entry"><b>Date:</b> {{ post.get_state_display }}</div>
						<div class="entry"><b>Color:</b> {{ post.colour }}</div>
						<div class="entry"><b>Breed:</b> {{ post.breed }}</div>
						<div class="entry"><b>Sex:</b>  {{ post.get_sex_display }}</div><br>
						<div class="entry"><a href="/{{ post.id }}/post">More Details</a></div>
					</div><br>
				{% endifnotequal %}
			{% endfor %}
		</div>
	</div>
  </body>
</html>

 {% endblock %}
